require=function e(t,o,s){function i(r,n){if(!o[r]){if(!t[r]){var l="function"==typeof require&&require;if(!n&&l)return l(r,!0);if(c)return c(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var a=o[r]={exports:{}};t[r][0].call(a.exports,function(e){var o=t[r][1][e];return i(o?o:e)},a,a.exports,e,t,o,s)}return o[r].exports}for(var c="function"==typeof require&&require,r=0;r<s.length;r++)i(s[r]);return i}({bkControl:[function(e,t,o){"use strict";cc._RFpush(t,"a2864/5HpxMQqOfSMRCoyWc","bkControl"),cc.Class({"extends":cc.Component,properties:{act:cc.Animation},onLoad:function(){this.act.play("bk-scroll")}}),cc._RFpop()},{}],boomControl:[function(e,t,o){"use strict";cc._RFpush(t,"f17bbbFNgpHN532up2BK8Jt","boomControl"),cc.Class({"extends":cc.Component,properties:{act:cc.Animation},boom:function(){},onLoad:function(){this.act.play("boom")}}),cc._RFpop()},{}],bossControl:[function(e,t,o){"use strict";cc._RFpush(t,"de2d0GIQK5LsbfojPVKN5l3","bossControl"),cc.Class({"extends":cc.Component,properties:{act:cc.Animation},fly:function(){this.act.play("boss-fly")},onLoad:function(){this.fly()},subHp:function(){cc.log("subHp is called")}}),cc._RFpop()},{}],enemyControl:[function(e,t,o){"use strict";cc._RFpush(t,"459c0raOhND7ZCGFjjbt7r1","enemyControl"),cc.Class({"extends":cc.Component,properties:{act:cc.Animation},fly:function(){this.act.play("enemy-fly")},test:function(){cc.log("a")},onLoad:function(){this.fly()}}),cc._RFpop()},{}],heroControl:[function(e,t,o){"use strict";cc._RFpush(t,"d4075KkCuJEd4a5eUsyY5uI","heroControl"),cc.Class({"extends":cc.Component,properties:{act:cc.Animation},onLoad:function(){this.act.play("hero-fly")},update:function(e){}}),cc._RFpop()},{}],main:[function(e,t,o){"use strict";cc._RFpush(t,"c0343Zi0BFEa5evexTlJ+6i","main"),cc.Class({"extends":cc.Component,properties:{hero:{"default":null,type:cc.Node},enemy:{"default":null,type:cc.Node},boss:{"default":null,type:cc.Node},bullet:{"default":null,type:cc.Node},bossBullet:{"default":null,type:cc.Node},boom:{"default":null,type:cc.Node},score_label:{"default":null,type:cc.Node},size:null,speed:3,spCreateEnemy:2,spCreateBullet:.5,spCreateBossBullet:1,bulletArr:[],enemyArr:[],bossArr:[],bossBulletArr:[],heroIsLife:!0,enemy_score:10,boss_score:100,score:0,e_count:0,heroBulletPower:10,heroBoundLeft:0,heroBoundRight:0},onPlayerClick:function(e){if(this.heroIsLife){var t=e.getLocation(),o=this.hero.getPosition(),s=this.node.convertToWorldSpaceAR(o),i=t.x-s.x;i=Math.abs(i)/300;var c=this.node.convertToNodeSpaceAR(cc.v2(t.x,t.y));c.x<this.heroBoundLeft&&(c.x=this.heroBoundLeft),c.x>this.heroBoundRight&&(c.x=this.heroBoundRight);var r=cc.moveTo(i,cc.p(c.x,o.y));this.hero.stopAllActions(),this.hero.runAction(r)}},onCreateEnemy:function(){if(this.heroIsLife){var e=Math.random()*this.size.width;e=Math.ceil(e);var t=cc.instantiate(this.enemy);this.enemyArr.push(t),this.node.addChild(t);var o=this.node.convertToNodeSpaceAR(cc.v2(e,0));o.x<this.heroBoundLeft&&(o.x=this.heroBoundLeft),o.x>this.heroBoundRight&&(o.x=this.heroBoundRight),t.setPosition(o.x,this.size.height/2);var s=cc.moveTo(this.speed,cc.p(o.x,-(this.size.height/2+this.enemy.height*this.enemy.scaleY/2))),i=this;t.runAction(cc.sequence(s,cc.callFunc(function(){cc.js.array.remove(i.enemyArr,t)}),cc.removeSelf()))}},onCreateBullet:function(){if(this.heroIsLife){var e=this.hero.getPosition(),t=cc.instantiate(this.bullet);this.bulletArr.push(t),this.node.addChild(t),t.setPosition(e.x,e.y),t.setLocalZOrder(1);var o=cc.moveTo(this.speed,cc.p(e.x,this.size.height/2+this.bullet.height*this.bullet.scaleY/2));t.runAction(cc.sequence(o,cc.callFunc(this.removeBulletFromArr.bind(this),t),cc.removeSelf()))}},removeBulletFromArr:function(e){cc.js.array.remove(this.bulletArr,e)},onCreateBossBullet:function(){if(this.heroIsLife&&!(this.bossArr.length<=0))for(var e in this.bossArr){var t=this.bossArr[e]._node.getPosition(),o=cc.instantiate(this.bossBullet);this.bossBulletArr.push(o),this.node.addChild(o),o.setPosition(t.x,t.y),o.setLocalZOrder(1);var s=cc.moveTo(this.speed,cc.p(t.x,-1*(this.size.height/2+this.bullet.height*this.bullet.scaleY/2)));o.runAction(cc.sequence(s,cc.callFunc(this.removeBossBulletFromArr.bind(this),o),cc.removeSelf()))}},removeBossBulletFromArr:function(e){cc.js.array.remove(this.bossBulletArr,e)},createBoss:function(e){if(this.heroIsLife){var t=cc.instantiate(this.boss),o=this.size.width/2-this.boss.width*this.boss.scaleX/2;this.node.addChild(t);var s=this.bossArr.length*(this.boss.height*this.boss.scaleY+20),i=this.size.height/2-s-this.boss.height*this.boss.scaleY;t.setPosition(-1*o,i),t.setLocalZOrder(2),this.bossArr.push({_node:t,_hp:100});var c=cc.moveTo(6,cc.p(o,i)),r=cc.moveTo(6,cc.p(-1*o,i));t.runAction(cc.repeatForever(cc.sequence(c,r)))}},onLoad:function(){cc.director.getScene();this.size=cc.director.getVisibleSize(),this.heroBoundLeft=-1*(this.size.width/2-this.hero.width*this.hero.scaleX/2),this.heroBoundRight=this.size.width/2-this.hero.width*this.hero.scaleX/2;var e=this;this.hero.setLocalZOrder(2);var t=this.score_label.getPosition();this.score_label.setPosition(this.size.width/2*-1+50,t.y),this.score_label.setLocalZOrder(4),this.node.on(cc.Node.EventType.TOUCH_START,function(t){e.onPlayerClick(t)}),this.schedule(function(){e.onCreateEnemy()},this.spCreateEnemy),this.schedule(function(){e.onCreateBullet()},this.spCreateBullet),this.schedule(function(){e.onCreateBossBullet()},this.spCreateBossBullet)},update:function(e){this.score_label.getComponent(cc.Label).string=this.score;for(var t in this.enemyArr){var o=!0;if(this.enemyArr[t].isChildOf(this.node)||cc.js.array.remove(this.enemyArr,this.enemyArr[t]),this.heroIsLife){var s=this.hero.getBoundingBoxToWorld();try{if(s.intersects(this.enemyArr[t].getBoundingBoxToWorld())){this.heroIsLife=!1,this.hero.stopAllActions();var i=this.enemyArr[t];i.stopAllActions();var c=cc.instantiate(this.boom);this.node.addChild(c),c.setPosition(this.hero.getPosition()),c.setLocalZOrder(3);var r=cc.instantiate(this.boom);this.node.addChild(r),r.setPosition(i.getPosition()),r.setLocalZOrder(3),i.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),this.hero.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),c.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),r.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),this.unscheduleAllCallbacks();continue}}catch(n){cc.log(n.message)}}for(var l in this.bulletArr){this.bulletArr[l].isChildOf(this.node)||cc.js.array.remove(this.bulletArr,this.bulletArr[l]);try{var h=this.bulletArr[l].getBoundingBoxToWorld();if(h.intersects(this.enemyArr[t].getBoundingBoxToWorld())){var a=this.bulletArr[l],i=this.enemyArr[t];i.stopAllActions();var c=cc.instantiate(this.boom);this.node.addChild(c),c.setLocalZOrder(3),c.setPosition(i.getPosition()),a.removeFromParent(),i.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),c.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),cc.js.array.removeAt(this.enemyArr,t),cc.js.array.removeAt(this.bulletArr,l),this.score+=this.enemy_score,++this.e_count%10==0&&this.createBoss(),o=!1;break}}catch(n){cc.log(n.message)}}}if(this.bossArr.length>0)for(var l in this.bossArr){var u=this.bossArr[l],d=u._node.getBoundingBoxToWorld();for(var t in this.bulletArr)try{if(d.intersects(this.bulletArr[t].getBoundingBoxToWorld())){var a=this.bulletArr[t],i=u._node;u._hp-=this.heroBulletPower,u._hp<=0&&(u._hp=0);var f=u._node.getComponent(cc.ProgressBar);f.progress=u._hp/100;var c=cc.instantiate(this.boom);this.node.addChild(c),c.setLocalZOrder(3),c.setPosition(i.getPosition()),a.removeFromParent(),c.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),cc.js.array.removeAt(this.bulletArr,t),u._hp<=0&&(cc.js.array.remove(this.bossArr,u),i.runAction(cc.sequence(cc.delayTime(.1),cc.removeSelf())),this.score+=this.boss_score)}}catch(n){cc.log(n.message)}}if(this.bossBulletArr.length>0&&this.heroIsLife){var m=this.hero.getBoundingBoxToWorld();for(var l in this.bossBulletArr)try{if(m.intersects(this.bossBulletArr[l].getBoundingBoxToWorld())){this.heroIsLife=!1,this.hero.stopAllActions();var i=this.bossBulletArr[l];cc.js.array.remove(this.bossBulletArr,i),i.removeFromParent();var c=cc.instantiate(this.boom);this.node.addChild(c),c.setPosition(this.hero.getPosition()),c.setLocalZOrder(3),this.hero.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),c.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),this.unscheduleAllCallbacks();break}}catch(n){cc.log(n.message)}}}}),cc._RFpop()},{}],start:[function(e,t,o){"use strict";cc._RFpush(t,"ff15e+J9U9NgJRl1P2u8tDe","start"),cc.Class({"extends":cc.Component,properties:{btn:{"default":null,type:cc.Button},loading:{"default":null,type:cc.Node}},onLoad:function(){this.loading.getComponent(cc.Label).enabled=!1},onStartClick:function(){this.btn.interactable=!1,this.loading.getComponent(cc.Label).enabled=!0,cc.log("load battle scene");var e=this;this.schedule(function(){var t=e.loading.getComponent(cc.Label).string;t="loading."==t?"loading..":"loading.."==t?"loading...":"loading.",e.loading.getComponent(cc.Label).string=t},1),cc.director.loadScene("battle")}}),cc._RFpop()},{}]},{},["enemyControl","bkControl","main","heroControl","bossControl","boomControl","start"]);