require=function e(t,o,s){function c(r,n){if(!o[r]){if(!t[r]){var l="function"==typeof require&&require;if(!n&&l)return l(r,!0);if(i)return i(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var a=o[r]={exports:{}};t[r][0].call(a.exports,function(e){var o=t[r][1][e];return c(o?o:e)},a,a.exports,e,t,o,s)}return o[r].exports}for(var i="function"==typeof require&&require,r=0;r<s.length;r++)c(s[r]);return c}({bkControl:[function(e,t,o){"use strict";cc._RFpush(t,"a2864/5HpxMQqOfSMRCoyWc","bkControl"),cc.Class({"extends":cc.Component,properties:{act:cc.Animation},onLoad:function(){this.act.play("bk-scroll")}}),cc._RFpop()},{}],boomControl:[function(e,t,o){"use strict";cc._RFpush(t,"f17bbbFNgpHN532up2BK8Jt","boomControl"),cc.Class({"extends":cc.Component,properties:{act:cc.Animation},boom:function(){},onLoad:function(){this.act.play("boom")}}),cc._RFpop()},{}],bossControl:[function(e,t,o){"use strict";cc._RFpush(t,"de2d0GIQK5LsbfojPVKN5l3","bossControl"),cc.Class({"extends":cc.Component,properties:{act:cc.Animation},fly:function(){this.act.play("enemy-fly")},onLoad:function(){this.fly()},subHp:function(){cc.log("subHp is called")}}),cc._RFpop()},{}],enemyControl:[function(e,t,o){"use strict";cc._RFpush(t,"459c0raOhND7ZCGFjjbt7r1","enemyControl"),cc.Class({"extends":cc.Component,properties:{act:cc.Animation},fly:function(){this.act.play("enemy-fly")},test:function(){cc.log("a")},onLoad:function(){this.fly()}}),cc._RFpop()},{}],heroControl:[function(e,t,o){"use strict";cc._RFpush(t,"d4075KkCuJEd4a5eUsyY5uI","heroControl"),cc.Class({"extends":cc.Component,properties:{act:cc.Animation},onLoad:function(){this.act.play("hero-fly")},update:function(e){}}),cc._RFpop()},{}],main:[function(e,t,o){"use strict";cc._RFpush(t,"c0343Zi0BFEa5evexTlJ+6i","main"),cc.Class({"extends":cc.Component,properties:{hero:{"default":null,type:cc.Node},enemy:{"default":null,type:cc.Node},boss:{"default":null,type:cc.Node},bullet:{"default":null,type:cc.Node},bossBullet:{"default":null,type:cc.Node},boom:{"default":null,type:cc.Node},score_label:{"default":null,type:cc.Node},size:null,speed:3,spCreateEnemy:2,spCreateBullet:.5,spCreateBossBullet:1,bulletArr:[],enemyArr:[],bossArr:[],bossBulletArr:[],heroIsLife:!0,enemy_score:10,boss_score:100,score:0,e_count:0,heroBulletPower:10},onPlayerClick:function(e){if(this.heroIsLife){var t=e.getLocation(),o=this.hero.getPosition(),s=this.node.convertToWorldSpaceAR(o),c=t.x-s.x;c=Math.abs(c)/300;var i=this.node.convertToNodeSpaceAR(cc.v2(t.x,t.y)),r=cc.moveTo(c,cc.p(i.x,o.y));this.hero.stopAllActions(),this.hero.runAction(r)}},onCreateEnemy:function(){if(this.heroIsLife){var e=Math.random()*this.size.width;e=Math.ceil(e);var t=cc.instantiate(this.enemy);this.enemyArr.push(t),this.node.addChild(t);var o=this.node.convertToNodeSpaceAR(cc.v2(e,0));t.setPosition(o.x,this.size.height/2);var s=cc.moveTo(this.speed,cc.p(o.x,-(this.size.height/2+this.enemy.height*this.enemy.scaleY/2)));t.runAction(cc.sequence(s,cc.removeSelf()))}},onCreateBullet:function(){if(this.heroIsLife){var e=this.hero.getPosition(),t=cc.instantiate(this.bullet);this.bulletArr.push(t),this.node.addChild(t),t.setPosition(e.x,e.y),t.setLocalZOrder(1);var o=cc.moveTo(this.speed,cc.p(e.x,this.size.height/2+this.bullet.height*this.bullet.scaleY/2));t.runAction(cc.sequence(o,cc.callFunc(this.removeBulletFromArr.bind(this),t),cc.removeSelf()))}},removeBulletFromArr:function(e){cc.js.array.remove(this.bulletArr,e)},onCreateBossBullet:function(){if(this.heroIsLife&&!(this.bossArr.lenght<=0))for(var e in this.bossArr){var t=this.bossArr[e]._node.getPosition(),o=cc.instantiate(this.bossBullet);this.bossBulletArr.push(o),this.node.addChild(o),o.setPosition(t.x,t.y),o.setLocalZOrder(1);var s=cc.moveTo(this.speed,cc.p(t.x,-1*(this.size.height/2+this.bullet.height*this.bullet.scaleY/2))),c=this;o.runAction(cc.sequence(s,cc.callFunc(function(){cc.js.array.remove(c.bossBulletArr,o)}),cc.removeSelf()))}},createBoss:function(e){if(this.heroIsLife){var t=cc.instantiate(this.boss),o=this.size.width/2-this.boss.width*this.boss.scaleX/2;this.node.addChild(t);var s=this.size.height/2-this.enemy.height*this.enemy.scaleY;t.setPosition(-1*o,s),t.setLocalZOrder(2),this.bossArr.push({_node:t,_hp:100});var c=cc.moveTo(6,cc.p(o,s)),i=cc.moveTo(6,cc.p(-1*o,s));t.runAction(cc.repeatForever(cc.sequence(c,i)))}},onLoad:function(){cc.director.getScene();this.size=cc.director.getVisibleSize(),cc.log(this.size);var e=this;this.hero.setLocalZOrder(2);var t=this.score_label.getPosition();this.score_label.setPosition(this.size.width/2*-1+50,t.y),cc.log(this.score_label.getPosition()),this.score_label.setLocalZOrder(4),this.node.on(cc.Node.EventType.TOUCH_START,function(t){e.onPlayerClick(t)}),this.schedule(function(){e.onCreateEnemy()},this.spCreateEnemy),this.schedule(function(){e.onCreateBullet()},this.spCreateBullet),this.schedule(function(){e.onCreateBossBullet()},this.spCreateBossBullet)},update:function(e){this.score_label.getComponent(cc.Label).string=this.score;for(var t in this.enemyArr){var o=!0;if(this.enemyArr[t].isChildOf(this.node)||cc.js.array.remove(this.enemyArr,this.enemyArr[t]),this.heroIsLife){var s=this.hero.getBoundingBoxToWorld();try{if(s.intersects(this.enemyArr[t].getBoundingBoxToWorld())){this.heroIsLife=!1,this.hero.stopAllActions();var c=this.enemyArr[t];c.stopAllActions();var i=cc.instantiate(this.boom);this.node.addChild(i),i.setPosition(this.hero.getPosition()),i.setLocalZOrder(3);var r=cc.instantiate(this.boom);this.node.addChild(r),r.setPosition(c.getPosition()),r.setLocalZOrder(3),c.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),this.hero.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),i.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),r.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),this.unscheduleAllCallbacks();continue}}catch(n){cc.log(n.message)}}for(var l in this.bulletArr){this.bulletArr[l].isChildOf(this.node)||cc.js.array.remove(this.bulletArr,this.bulletArr[l]);try{var h=this.bulletArr[l].getBoundingBoxToWorld();if(h.intersects(this.enemyArr[t].getBoundingBoxToWorld())){cc.log("is intersects");var a=this.bulletArr[l],c=this.enemyArr[t];c.stopAllActions();var i=cc.instantiate(this.boom);this.node.addChild(i),i.setLocalZOrder(3),i.setPosition(c.getPosition()),a.removeFromParent(),c.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),i.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),cc.js.array.removeAt(this.enemyArr,t),cc.js.array.removeAt(this.bulletArr,l),this.score+=this.enemy_score,++this.e_count%10==0&&this.createBoss(),o=!1;break}}catch(n){cc.log(n.message)}}}if(this.bossArr.length>0){cc.log("boss break test ");for(var l in this.bossArr){var u=this.bossArr[l],d=u._node.getBoundingBoxToWorld();for(var t in this.bulletArr)try{if(d.intersects(this.bulletArr[t].getBoundingBoxToWorld())){var a=this.bulletArr[t],c=u._node;u._hp-=this.heroBulletPower,u._hp<=0&&(u._hp=0);var p=u._node.getComponent(cc.ProgressBar);p.progress=u._hp/100;var i=cc.instantiate(this.boom);this.node.addChild(i),i.setLocalZOrder(3),i.setPosition(c.getPosition()),a.removeFromParent(),i.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),cc.js.array.removeAt(this.bulletArr,t),u._hp<=0&&(c.runAction(cc.sequence(cc.delayTime(.1),cc.removeSelf())),cc.js.array.removeAt(this.bossArr,l),this.score+=this.boss_score)}}catch(n){cc.log(n.message),cc.log(this.bulletArr[t])}}}if(this.bossBulletArr.length>0&&this.heroIsLife){var f=this.hero.getBoundingBoxToWorld();for(var l in this.bossBulletArr)if(f.intersects(this.bossBulletArr[l].getBoundingBoxToWorld())){this.heroIsLife=!1,this.hero.stopAllActions();var c=this.bossBulletArr[l];c.removeFromParent();var i=cc.instantiate(this.boom);this.node.addChild(i),i.setPosition(this.hero.getPosition()),i.setLocalZOrder(3),this.hero.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),i.runAction(cc.sequence(cc.delayTime(.5),cc.removeSelf())),this.unscheduleAllCallbacks();break}}}}),cc._RFpop()},{}],start:[function(e,t,o){"use strict";cc._RFpush(t,"ff15e+J9U9NgJRl1P2u8tDe","start"),cc.Class({"extends":cc.Component,properties:{btn:{"default":null,type:cc.Button}},onLoad:function(){},onStartClick:function(){cc.director.loadScene("battle")}}),cc._RFpop()},{}],test:[function(e,t,o){"use strict";cc._RFpush(t,"003b2yGF25PYr7yQL111/WT","test"),cc.Class({"extends":cc.Component,properties:{},onLoad:function(){var e=cc.director.getVisibleSize();cc.log(e);var t=this.node.getChildByName("enmyp1");cc.log(t);var o=t.getNodeToWorldTransformAR();cc.log(o.tx+"  "+o.ty),this.schedule(function(){var e=t.getPosition(),o=1e3*Math.random();o=Math.ceil(o);var s=cc.instantiate(t);this.node.addChild(s);var c=this.node.convertToNodeSpace(cc.v2(o,e.y));cc.log(c),s.setPosition(c)},1)}}),cc._RFpop()},{}]},{},["test","enemyControl","bkControl","main","heroControl","bossControl","boomControl","start"]);